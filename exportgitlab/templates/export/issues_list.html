{% extends "base.html" %}
{% load i18n %}
{% load export_extras %}

{% block title %}{% trans "issues"%}{% endblock title %}

{% block content %}
<div class="container">
    <h4 class="my-4">Project ID: {{ project.gitlab_id }} - {{ project.name }} - Issues</h4>
    <div class="well">
    <form method="GET" action="{% url "list_all_issues" id_pj=project.id%}" class="mb-4">
        <div class="row">
            <div class="col-md-3">
                <label for="iids">IID:</label>
                <input class="form-control" name="iid" id="iids" value="" placeholder="1,2,3,4">
                <br>
                <button class="btn btn" type="submit">{% trans "Filter"%}</button>
                <input class="btn btn" type="reset" value="{% trans "Reset" %}">
            </div>

            <div class="col-md-3">
                <label for="label_filter">{% trans "Labels:" %}</label>
                <div class="labels_filter">
                    {% for label in gitlab_labels %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" name="lab" value="{{ label }}">
                            <span style="background-color:{{ gitlab_labels|get_value:label }}" class="label label-default">{{ label }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="col-md-3">
                <label>{% trans "Status" %}</label>
                <div class="open-close">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="oc" id="opened" value="opened" checked>
                        <label class="form-check-label" for="opened">{% trans "Open" %}</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="oc" id="closed" value="closed">
                        <label class="form-check-label" for="closed">{% trans  "Close" %}</label>
                    </div>
                </div>
            </div>
        </div>
    </form>
    </div>

    <form method='POST' action="{% url "download_report_issues" id_pj=project.id%}" class="mb-4">
        {% csrf_token %}
        <button class="btn btn" type="submit">{% trans "Download" %}</button>

        <table class="table">
            <tbody>
                {% for issue in page_obj %}
                    <tr>
                        <td>
                            <input class="form-check-input" type="checkbox" name="checkbox_issues" id="checkbox_issues" value="{{ issue.iid }}">
                            <span>{{ issue.iid }} - {{ issue.title }}</span>
                            <span class="text-muted vertical-center">{{ issue.author.name }}</span>
                            {% for tag in issue.labels %}
                                <span style="background-color:{{ gitlab_labels|get_value:tag }}" class="label label-default">{{ tag }}</span>
                            {% endfor %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
</div>


{% if page_obj.next_page_number > 1 or page_obj.has_previous %}
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li><a href="?page=1">&laquo; {% trans "first" %}</a></li>
                    <li><a href="?page={{ page_obj.previous_page_number }}">{% trans "previous" %}</a></li>
                {% endif %}

                <li class="disabled">
                    <span>
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                    </span>
                </li>

                {% if page_obj.has_next %}
                    <li><a href="?page={{ page_obj.next_page_number }}">{% trans "next" %}</a></li>
                    <li><a href="?page={{ page_obj.paginator.num_pages }}">{% trans "last" %} &raquo;</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
